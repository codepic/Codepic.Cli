{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://raw.githubusercontent.com/codepic/Codepic.Cli/main/schema/cli/module-manifest/v1/schema.json",
  "title": "Codepic CLI Module Manifest",
  "description": "Schema describing module.manifest.json files consumed by the Codepic CLI packaging and lifecycle commands.",
  "type": "object",
  "additionalProperties": false,
  "required": ["name", "version", "description", "include"],
  "properties": {
    "$schema": {
      "type": "string",
      "description": "Optional reference to the published manifest schema. When specified, it must point to this schema version.",
      "const": "https://raw.githubusercontent.com/codepic/Codepic.Cli/main/schema/cli/module-manifest/v1/schema.json"
    },
    "name": {
      "type": "string",
      "description": "Lowercase identifier matching the module directory under modules/. Use '.' for the root module.",
      "pattern": "^[a-z0-9-\\.]+$",
      "examples": ["baseline", "sample", "."]
    },
    "version": {
      "type": "string",
      "description": "Semantic version string that identifies this module artifact.",
      "pattern": "^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:-[0-9A-Za-z-.]+)?(?:\\+[0-9A-Za-z-.]+)?$",
      "examples": ["0.1.0", "1.2.3-beta.1"]
    },
    "description": {
      "type": "string",
      "description": "Short human-readable summary of the module's purpose.",
      "minLength": 3,
      "examples": ["Baseline tasks for Codepic CLI."]
    },
    "install": {
      "type": "object",
      "description": "Optional onboarding guidance surfaced by consumers during installation flows.",
      "additionalProperties": false,
      "required": ["instructions"],
      "properties": {
        "instructions": {
          "type": "object",
          "description": "Instructional content tailored for humans and assisted agents during installation.",
          "additionalProperties": false,
          "minProperties": 1,
          "properties": {
            "human": {
              "$ref": "#/$defs/installInstruction",
              "description": "Plain-language instructions for operators installing the module."
            },
            "copilot": {
              "$ref": "#/$defs/installInstruction",
              "description": "Guidance for automated assistants that may execute the installation."
            }
          }
        }
      }
    },
    "include": {
      "type": "array",
      "description": "Set of repository-relative paths to package with the module. Paths must include the manifest itself.",
      "minItems": 1,
      "items": {
        "$ref": "#/$defs/repoPath"
      },
      "uniqueItems": true,
      "examples": [
        [
          "modules/sample/.tasks.ps1",
          "modules/sample/module.manifest.json",
          "modules/sample/module.tasks.instructions.md"
        ]
      ]
    },
    "exclude": {
      "type": "array",
      "description": "Optional repository-relative paths to remove after the include set has been resolved.",
      "items": {
        "$ref": "#/$defs/repoPath"
      },
      "uniqueItems": true,
      "examples": [["modules/sample/local.settings.json"]]
    },
    "source": {
      "type": "object",
      "description": "Metadata describing the canonical origin of this module.",
      "additionalProperties": false,
      "required": ["git"],
      "properties": {
        "git": {
          "type": "string",
          "description": "Repository URL used by clone-module/update-module when -Git is not supplied.",
          "format": "uri",
          "examples": ["https://github.com/codepic/Codepic.Cli.Sample.git"]
        },
        "tagPrefix": {
          "type": "string",
          "description": "Optional prefix prepended to version numbers when constructing git tags (defaults to 'v').",
          "minLength": 1,
          "examples": ["v", "release-"]
        }
      }
    }
  },
  "$defs": {
    "repoPath": {
      "type": "string",
      "description": "Repository-relative path using forward slashes, without leading ../ segments.",
      "pattern": "^(?!\\.{2})(?!/)(?!.*\\.{2}/)[A-Za-z0-9_.-]+(?:/[A-Za-z0-9_.-]+)*$",
      "examples": ["modules/sample/.tasks.ps1", "dist/sample/sample.0.2.0.zip"]
    },
    "installInstruction": {
      "description": "Either a single instruction string or an ordered list of instruction strings.",
      "oneOf": [
        {
          "type": "string",
          "minLength": 1
        },
        {
          "type": "array",
          "items": {
            "type": "string",
            "minLength": 1
          },
          "minItems": 1
        }
      ]
    }
  }
}
