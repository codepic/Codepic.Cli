---
applyTo: ".build.ps1"
---

# Codepic CLI build script instructions

## Role of `.build.ps1`

- Acts as the bootstrapper for the Codepic CLI.
- Installs/imports Invoke-Build when necessary and re-runs itself through Invoke-Build.
- Discovers and dot-sources every `*.tasks.ps1` file within the repository (recursively) so tasks become available to the pipeline.

## Required structure & conventions

- Keep existing parameters intact unless a change is explicitly required by new functionality.
- Do not introduce new top-level parameters for module-specific operations; rely on forwarding overflow arguments via `$RestArgs` so each task file can decide which parameters to consume.
- Preserve the `begin/process/end` blocks and the Invoke-Build invocation pattern.
- Any new parameters must include comment-based help entries and default values that maintain backwards compatibility.
- When adding logic that affects task discovery or module loading, ensure logging/verbose output is present to aid debugging.

## Azure DevOps / local execution notes

- The script auto-detects Azure DevOps via `TF_BUILD` and installs Invoke-Build accordingly. Local runs may require elevated privileges the first time modules are installed.
- Do not embed environment-specific secrets or assumptions in the script; keep it portable across CI/CD and local usage.

## Assistant responsibilities

- Before modifying `.build.ps1`, review current contents to avoid regressing bootstrap behavior.
- Document any new expectations or conventions here immediately after implementing them.
- When in doubt about task loading or aliases, inspect the relevant `.tasks.ps1` files (see `.tasks.instructions.md`).
- If conflicting guidance is discovered, follow the global alignment protocol: present options (`accept:a|b|c|d`) with pros/cons/blast radius/recommendation and wait for `accept:`, `question:`, or `adjust:` before proceeding.
